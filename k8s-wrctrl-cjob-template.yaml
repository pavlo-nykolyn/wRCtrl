# Author: Pavlo Nykolyn
apiVersion: batch/v1
kind: CronJob
metadata:
   name: wrctrl-cjob-
   namespace: utility-objects
spec:
   schedule: ""
   timeZone: "Europe/Rome"
   jobTemplate:
      spec:
         template:
            metadata:
               name: wrctrl-controller
               namespace: utility-objects
            spec:
               volumes:
                  # needed for collecting log information generated by the container
                  - name: wrctrl-controller-log-data
                    hostPath:
                       path: 
                       type: Directory
               containers:
                  - name: wrctrl-controller
                    image:
                    imagePullPolicy: IfNotPresent
                    volumeMounts:
                       - name: wrctrl-controller-log-data
                         mountPath: /wRCtrl/logs
                    env:
                       - name: RELAY_ARRAY_CONFIGURATION
                         valueFrom:
                            configMapKeyRef:
                               name:
                               key: relay-array-configuration
                       - name: IDS
                         valueFrom:
                            configMapKeyRef:
                               name:
                               key: ids
               resources:
                  # I reckon that one tenth of a Kubernetes CPU are sufficient for running a controller that performs synchronous actions
                  requests:
                     memory: "64Mi"
                     cpu: "100m"
                  limits:
                     memory: "128Mi"
                     cpu: "100m"
               restartPolicy: OnFailure
